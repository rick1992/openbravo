<?xml version="1.0"?>
  <database name="VIEW SWA_PORDERIMPORTDETAIL_V">
    <view name="SWA_PORDERIMPORTDETAIL_V"><![CDATA[SELECT COALESCE(l.sim_orderimportline_id, '-') || l.m_product_id AS swa_porderimportdetail_v_id, l.ad_client_id, l.ad_org_id, l.isactive, l.updated, l.updatedby, l.created, l.createdby, l.sim_orderimport_id, l.m_product_id, l.c_uom_id, l.pricelist, l.priceactual, l.qtyordered, l.linenetamt, l.description, a.p_lista_pen, a.p_lista_usd, COALESCE(sum(pw.stock_onhand), 0) AS qtyonhand, COALESCE(sum(pw.stock_reserved), 0) AS qtyreserved, COALESCE(sum(pw.stock_onhand - pw.stock_reserved), 0) AS qtyavailable, l.line FROM sim_orderimportline l JOIN (SELECT mp.m_product_id, COALESCE((SELECT spc.pricelist FROM ssa_product_currprice_v spc JOIN m_pricelist mpl ON spc.m_pricelist_id = mpl.m_pricelist_id WHERE mpl.issopricelist = 'Y' AND mpl.c_currency_id = '308' AND spc.m_product_id = mp.m_product_id), 0.00) AS p_lista_pen, COALESCE((SELECT spc.pricelist FROM ssa_product_currprice_v spc JOIN m_pricelist mpl ON spc.m_pricelist_id = mpl.m_pricelist_id WHERE mpl.issopricelist = 'Y' AND mpl.c_currency_id = '100' AND spc.m_product_id = mp.m_product_id), 0.00) AS p_lista_usd FROM m_product mp) a ON a.m_product_id = l.m_product_id LEFT JOIN (SELECT ppwv.m_product_id, CASE WHEN w.em_swa_warehousetype = 'CO' OR w.em_swa_warehousetype = 'MI' THEN COALESCE(ppwv.qtyonhand * COALESCE(w.em_swa_percentconsig_instock, 100) / 100.0, 0) ELSE COALESCE(ppwv.qtyonhand, 0) END AS stock_onhand, COALESCE(ppwv.qtyreserved, 0) AS stock_reserved FROM scr_warehouse_total_qty_v ppwv JOIN m_warehouse w ON w.m_warehouse_id = ppwv.m_warehouse_id WHERE w.em_swa_warehousetype = 'NO' OR w.em_swa_warehousetype = 'CO' OR w.em_swa_warehousetype = 'MI') pw ON pw.m_product_id = l.m_product_id, m_product p WHERE p.m_product_id = l.m_product_id GROUP BY l.sim_orderimportline_id, l.ad_client_id, l.ad_org_id, l.isactive, l.updated, l.updatedby, l.created, l.createdby, l.sim_orderimport_id, l.m_product_id, l.c_uom_id, l.pricelist, l.priceactual, l.qtyordered, l.linenetamt, a.p_lista_pen, a.p_lista_usd, l.line, l.description]]></view>
  </database>
