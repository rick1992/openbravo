<?xml version="1.0"?>
  <database name="TRIGGER SSA_INVLINE_IMPV_CHK_TRG">
    <trigger name="SSA_INVLINE_IMPV_CHK_TRG" table="C_INVOICELINE" fires="before" insert="true" update="true" delete="true" foreach="row">
      <body><![CDATA[
  v_em_sim_is_import  CHAR(1);
  v_C_INVOICE_ID VARCHAR(32) ;
  v_C_ORDERLINE_ID VARCHAR(32) ;
    
BEGIN
    
  IF AD_isTriggerEnabled()='N' THEN RETURN;
  END IF;


  IF INSERTING THEN
    v_C_INVOICE_ID:=:NEW.C_INVOICE_ID;
    v_C_ORDERLINE_ID:=:NEW.C_ORDERLINE_ID;
  ELSE
    v_C_INVOICE_ID:=:OLD.C_INVOICE_ID;
    v_C_ORDERLINE_ID:=:OLD.C_ORDERLINE_ID;
  END IF;
  
  --BEGIN NO SE PUEDEN EDITAR LINEAS INVOICE SI FUERON CREADAS DIRECTAMENTE DESDE UN PARCIAL(IMPORTACIÃ“N)
 IF (UPDATING) THEN
   SELECT em_sim_is_import 
     INTO v_em_sim_is_import 
     FROM C_ORDER 
       INNER JOIN C_ORDERLINE ON C_ORDER.C_ORDER_ID = C_ORDERLINE.C_ORDER_ID
    WHERE C_ORDERLINE_ID = v_C_ORDERLINE_ID;
  --END BEGIN 
    IF (v_em_sim_is_import = 'Y' AND (
      (COALESCE(:OLD.LINE, 0) <> COALESCE(:NEW.LINE, 0))
      OR(COALESCE(:OLD.M_PRODUCT_ID, '0') <> COALESCE(:NEW.M_PRODUCT_ID, '0'))
      OR(COALESCE(:OLD.QTYINVOICED, 0) <> COALESCE(:NEW.QTYINVOICED, 0))
      OR(COALESCE(:OLD.LINE, 0) <> COALESCE(:NEW.LINE, 0))
      OR(COALESCE(:OLD.PRICELIST, 0) <> COALESCE(:NEW.PRICELIST, 0))
      OR(COALESCE(:OLD.PRICELIMIT, 0) <> COALESCE(:NEW.PRICELIMIT, 0))
      OR(COALESCE(:OLD.C_CHARGE_ID, '0') <> COALESCE(:NEW.C_CHARGE_ID, '0'))
      OR(COALESCE(:OLD.C_UOM_ID, '0') <> COALESCE(:NEW.C_UOM_ID, '0'))
      OR(COALESCE(:OLD.C_TAX_ID, '0') <> COALESCE(:NEW.C_TAX_ID, '0'))
      OR(COALESCE(:OLD.M_ATTRIBUTESETINSTANCE_ID, '0') <> COALESCE(:NEW.M_ATTRIBUTESETINSTANCE_ID, '0'))
      OR(COALESCE(:OLD.QUANTITYORDER, 0) <> COALESCE(:NEW.QUANTITYORDER, 0))
      OR(COALESCE(:OLD.C_ORDERLINE_ID, '0') <> COALESCE(:NEW.C_ORDERLINE_ID, '0'))
      OR(COALESCE(:OLD.M_PRODUCT_UOM_ID, '0') <> COALESCE(:NEW.M_PRODUCT_UOM_ID, '0'))
      OR(COALESCE(:OLD.AD_ORG_ID, '0') <> COALESCE(:NEW.AD_ORG_ID, '0'))
      OR(COALESCE(:OLD.AD_CLIENT_ID, '0') <> COALESCE(:NEW.AD_CLIENT_ID, '0'))
    )) THEN
      RAISE_APPLICATION_ERROR(-20000, '@sim_invoicelinecannotbemodify@') ;
    END IF;
 END IF;
 
  END SSA_INVLINE_IMPV_CHK_TRG
]]></body>
    </trigger>
  </database>
