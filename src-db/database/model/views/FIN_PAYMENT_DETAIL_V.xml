<?xml version="1.0"?>
  <database name="VIEW FIN_PAYMENT_DETAIL_V">
    <view name="FIN_PAYMENT_DETAIL_V"><![CDATA[SELECT psd.fin_payment_scheduledetail_id AS fin_payment_detail_v_id, psd.ad_client_id, psd.ad_org_id, psd.isactive, psd.created, psd.createdby, psd.updated, psd.updatedby, pso.fin_payment_schedule_id AS fin_payment_sched_ord_v_id, psi.fin_payment_schedule_id AS fin_payment_sched_inv_id, pso.fin_payment_schedule_id AS fin_payment_sched_ord_id, i.documentno AS invoiceno, o.documentno AS orderno, p.documentno AS paymentno, pd.fin_payment_id, COALESCE(psi.duedate, pso.duedate) AS duedate, COALESCE(i.grandtotal, o.grandtotal) AS invoicedamt, COALESCE(psi.amount, pso.amount) AS expected, psd.amount AS paidamt, p.c_bpartner_id, p.fin_paymentmethod_id, p.fin_financial_account_id, p.c_currency_id, p.paymentdate, gli.name AS glitemname, pd.writeoffamt, fa.c_currency_id AS finacc_currency_id, p.finacc_txn_convert_rate, psd.amount * p.finacc_txn_convert_rate AS paidconverted, COALESCE(psi.amount, pso.amount) * p.finacc_txn_convert_rate AS expectedconverted, psd.iscanceled, psd.c_bpartner_id AS c_bpartner_id_dim, psd.c_activity_id, psd.m_product_id, psd.c_campaign_id, psd.c_project_id, psd.c_salesregion_id, p.status, psd.fin_payment_scheduledetail_id AS em_sco_psd_id, i.em_scr_physical_documentno AS em_sco_invoicephysicalno, o.poreference AS em_sco_orderporeference, pd.fin_payment_detail_id AS em_sco_pd_id, pd.em_sco_description, pd.em_sco_doc_currency_id, pd.em_sco_convert_rate, pd.em_sco_alt_convert_rate, pd.em_sco_paymentamount, NULL AS em_sco_prepayment_id, NULL AS em_sco_rendcuentas_id, CASE WHEN i.c_bpartner_id IS NOT NULL THEN i.c_bpartner_id WHEN o.c_bpartner_id IS NOT NULL THEN o.c_bpartner_id WHEN invglref.c_bpartner_id IS NOT NULL THEN invglref.c_bpartner_id WHEN idoc.c_bpartner_id IS NOT NULL THEN idoc.c_bpartner_id ELSE psd.c_bpartner_id END AS em_sco_c_bpartner_id, pd.em_sco_discboe_id, psd.c_costcenter_id AS em_sco_c_costcenter_id, psd.em_sco_internal_doc_id, psd.em_sco_invoice_glref_id, pd.em_sco_respbpartner_id, pd.em_sco_factoredinv_id, pd.em_sco_loandocli_inv_id, psd.em_sco_eeff_cashflow_id FROM fin_payment p LEFT JOIN fin_financial_account fa ON p.fin_financial_account_id = fa.fin_financial_account_id, fin_payment_detail pd JOIN fin_payment_scheduledetail psd ON pd.fin_payment_detail_id = psd.fin_payment_detail_id LEFT JOIN fin_payment_schedule psi ON psd.fin_payment_schedule_invoice = psi.fin_payment_schedule_id LEFT JOIN c_invoice i ON psi.c_invoice_id = i.c_invoice_id LEFT JOIN fin_payment_schedule pso ON psd.fin_payment_schedule_order = pso.fin_payment_schedule_id LEFT JOIN c_order o ON pso.c_order_id = o.c_order_id LEFT JOIN c_glitem gli ON pd.c_glitem_id = gli.c_glitem_id LEFT JOIN c_invoice invglref ON invglref.c_invoice_id = psd.em_sco_invoice_glref_id LEFT JOIN sco_internal_doc idoc ON idoc.sco_internal_doc_id = psd.em_sco_internal_doc_id WHERE p.fin_payment_id = pd.fin_payment_id UNION SELECT pd.fin_payment_detail_id AS fin_payment_detail_v_id, pd.ad_client_id, pd.ad_org_id, pd.isactive, pd.created, pd.createdby, pd.updated, pd.updatedby, NULL AS fin_payment_sched_ord_v_id, NULL AS fin_payment_sched_inv_id, NULL AS fin_payment_sched_ord_id, NULL AS invoiceno, NULL AS orderno, p.documentno AS paymentno, pd.fin_payment_id, NULL AS duedate, NULL AS invoicedamt, NULL AS expected, pd.amount AS paidamt, p.c_bpartner_id, p.fin_paymentmethod_id, p.fin_financial_account_id, p.c_currency_id, p.paymentdate, NULL AS glitemname, pd.writeoffamt, fa.c_currency_id AS finacc_currency_id, p.finacc_txn_convert_rate, NULL AS paidconverted, NULL AS expectedconverted, 'N' AS iscanceled, NULL AS c_bpartner_id_dim, NULL AS c_activity_id, NULL AS m_product_id, NULL AS c_campaign_id, NULL AS c_project_id, NULL AS c_salesregion_id, p.status, NULL AS em_sco_psd_id, NULL AS em_sco_invoicephysicalno, NULL AS em_sco_orderporeference, pd.fin_payment_detail_id AS em_sco_pd_id, pd.em_sco_description, pd.em_sco_doc_currency_id, pd.em_sco_convert_rate, pd.em_sco_alt_convert_rate, pd.em_sco_paymentamount, pd.em_sco_prepayment_id, pd.em_sco_rendcuentas_id, NULL AS em_sco_c_bpartner_id, pd.em_sco_discboe_id, NULL AS em_sco_c_costcenter_id, NULL AS em_sco_internal_doc_id, NULL AS em_sco_invoice_glref_id, pd.em_sco_respbpartner_id, pd.em_sco_factoredinv_id, pd.em_sco_loandocli_inv_id, NULL AS em_sco_eeff_cashflow_id FROM fin_payment p LEFT JOIN fin_financial_account fa ON p.fin_financial_account_id = fa.fin_financial_account_id, fin_payment_detail pd WHERE (pd.em_sco_isprepayment = 'Y' AND pd.em_sco_prepayment_id IS NOT NULL OR pd.em_sco_isrendcuentas = 'Y' AND pd.em_sco_rendcuentas_id IS NOT NULL) AND p.fin_payment_id = pd.fin_payment_id]]></view>
  </database>
